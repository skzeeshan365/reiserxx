{% extends 'main/base.html' %}
{% load static %}
{% block meta_tags %}
    <!-- META TAGS -->
    <meta property="og:title" content="ReiserX"/>
    <meta property="og:description" content="Discover the wonders of science with us"/>
    <meta property="og:image" content="{% static 'reiserx/img/logo.png' %}"/>
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="website">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <!-- META TAGS -->
{% endblock %}
{% block content %}
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/>

    <style>
        .cc-window {
            max-width: 600px;
            margin: 0 auto;
            border-radius: 10px;
            box-shadow: 0 0 5px rgba(162, 162, 162, 0.5);
            font-family: Arial, sans-serif;
            background-color: #fff;
        }

        .cc-message {
            color: #333;
            font-size: 16px;
            line-height: 1.5;
            text-align: left;
        }

        .cc-link {
            color: #349d00 !important;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
        }

        .cc-link:hover {
            color: #d5d5d5;
        !important;
            text-decoration: none;
        }

        .cc-compliance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding: 20px;
        }

        .cc-compliance a {
            color: #333;
            font-size: 16px;
            font-weight: bold;
            display: block;
        }

        .cc-compliance a:hover {
            color: #ffffff;
        }

        .cc-compliance .cc-btn.cc-allow {
            background-color: #349d00;
            color: #fff;
            font-size: 16px;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            text-decoration: none;
        }

        .cc-compliance .cc-btn.cc-allow:hover {
            background-color: #195400;
            color: #fff;
        }

        .cc-compliance .cc-btn.cc-deny {
            background-color: #ffcece;
            color: #ffffff;
        !important;
            font-size: 16px;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            text-decoration: none;
        }

        .cc-compliance .cc-btn.cc-deny:hover {
            background-color: #ff3030;
            color: #fff;
            text-decoration: none;
        }

        .center-horizontal {
            display: flex;
            justify-content: center;
            overflow-x: hidden;
        }

        .container.listfeaturedtag {
            margin: 0;
            padding: 0;
        }

        .card.border-0 {
            margin: 0;
            padding: 0;
        }
    </style>

    <div class="row center-horizontal m-0">
        <div class="col-xs-2 col-sm-4 col-md-6 col-lg-6 wow fadeInLeft" data-wow-offset="50" data-wow-delay="0.9s">
            <div class="container-fluid listfeaturedtag">
                <!-- Begin List Posts -->
                <div class="section-title">
                    <h2><span>For you</span></h2>
                </div>
                <div class="row" id="post-list">

                    {% for _ in "xxxxx"|slice:":4" %}
                    <!-- Placeholder post -->
                    <div class="col-md-10 col-xl-12 col-xs-10 col-sm-8 placeholder-post">
                        <div class="card border-0">
                            <div class="card-block">
                                <div class="row" style="align-items: center">
                                    <div class="col-10">
                                        <h5 class="card-title placeholder-glow placeholder-color">
                                            <span class="placeholder col-6 placeholder-lg"
                                                  style="height: 25px; margin-top: 8px"></span>
                                        </h5>
                                        <p class="card-text placeholder-glow">
                                            <span class="placeholder col-7 placeholder-color" style="height: 20px; margin-bottom: 8px; margin-top: 8px"></span>
                                            <span class="placeholder col-4 placeholder-color"
                                                  style="height: 20px; margin-bottom: 8px"></span>
                                            <span class="placeholder col-4 placeholder-color"
                                                  style="height: 20px; margin-bottom: 8px"></span>
                                            <span class="placeholder col-6 placeholder-color" style="height: 20px; margin-bottom: 8px"></span>
                                        </p>
                                        <div class="metafooter">
                                            <div class="wrapfooter placeholder-glow">
                                                <span class="placeholder col-4 placeholder-color" style="height: 15px"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="thumbnail">
                                            <div class="card-img-top placeholder placeholder-glow"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <!-- End placeholders -->
                    {% endfor %}
                </div>
                <style>
                    .card-img-top.placeholder {
                        color: rgb(215, 215, 215);
                        height: 100px;
                        width: 100%;
                    }

                    .placeholder-color {
                        color: rgb(215, 215, 215);
                    }

                    .tag-placeholder {
                        height: 35px;
                        border-radius: 50px;
                        margin-top: 4px;
                        margin-bottom: 2px;
                    }
                    hr {
	background-color: #c0c0c0;
}
                </style>
                <div id="sentinel"></div>
                <!-- End List Posts -->

                <!-- Placeholder post -->
                <div id="placeholder-template" style="display: none;">
                    <div class="col-md-10 col-xl-12 col-xs-10 col-sm-8 placeholder-post">
                        <div class="card border-0">
                            <div class="card-block">
                                <div class="row" style="align-items: center">
                                    <div class="col-10">
                                        <h5 class="card-title placeholder-glow">
                                            <span class="placeholder col-6 placeholder-lg"
                                                  style="height: 25px; margin-top: 8px"></span>
                                        </h5>
                                        <p class="card-text placeholder-glow">
                            <span class="placeholder col-7"
                                  style="height: 20px; margin-bottom: 8px; margin-top: 8px"></span>
                                            <span class="placeholder col-4"
                                                  style="height: 20px; margin-bottom: 8px"></span>
                                            <span class="placeholder col-4"
                                                  style="height: 20px; margin-bottom: 8px"></span>
                                            <span class="placeholder col-6"
                                                  style="height: 20px; margin-bottom: 8px"></span>
                                        </p>
                                        <div class="metafooter">
                                            <div class="wrapfooter placeholder-glow">
                                                <span class="placeholder col-4" style="height: 15px"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="thumbnail">
                                            <div class="card-img-top placeholder"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End placeholders -->
            </div>
        </div>
        <div class="col-md-2 col-sm-2 col-xs-2 wow fadeInRight" data-wow-offset="50" data-wow-delay="0.6s"
             style="margin: 50px" id="tag-container">
            <!-- Begin Tags -->
            <div class="after-post-tags" style="width: 150%;">
                <h6><span>Recommended topics</span></h6>
                <ul class="tags" id="tag-list" style="margin: unset">
                    <li class="placeholder-glow placeholder-color m-0"><span class="placeholder tag-placeholder" style="width: 110px;"></span></li>
                    <li class="placeholder-glow placeholder-color m-0"><span class="placeholder tag-placeholder" style="width: 70px;"></span></li>

                    <li class="placeholder-glow placeholder-color m-0"><span class="placeholder tag-placeholder" style="width: 80px;"></span></li>
                    <li class="placeholder-glow placeholder-color m-0"><span class="placeholder tag-placeholder" style="width: 90px;"></span></li>

                    <li class="placeholder-glow placeholder-color"><span class="placeholder tag-placeholder" style="width: 120px;"></span></li>
                    <li class="placeholder-glow placeholder-color m-0"><span class="placeholder tag-placeholder" style="width: 140px;"></span></li>
                </ul>
            </div>
            <!-- End Tags -->
            <hr>
            <!-- Begin updates -->
            <div class="after-post-tags" style="width: 150%; margin-top: 20px; align-items: center">
                <h6><span>Get updates</span></h6>
                <a style="margin-top: 10px; margin-left: unset;" href="{% url 'subscribe' %}" class="btn subscribe">SUBSCRIBE</a>

                <a href="https://www.instagram.com/reiserx.info/"><svg style="margin-top: 10px; margin-left: 10px;" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
                    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"></path></svg>
                </a>

            </div>
            <!-- End updates -->

            <!-- Begin reading list -->
            <div class="after-post-tags" style="width: 150%; margin-top: 20px">
                <h6><span>Read</span></h6>
                <p style="font-size: 14px; font-weight: 400; color: #5d5d5d">Click the save icon on any story to save it to your personal reading collection or a customized list.</p>
            </div>
            <!-- End reading list -->
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script>
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#ffffff"
                },
                "button": {
                    "background": "#349d00"
                }
            },
            "position": "bottom-left",
            "type": "opt-in",
            "content": {
                "message": "This website uses cookies to ensure you get the best experience.",
                "deny": "Deny",
                "allow": "Accept",
                "href": "{% url 'policy' %}"
            }
        });
        var screenWidth = window.innerWidth;
    </script>

    <!-- JavaScript code -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var currentPage = 1;
        var loadMoreUrl = "{% url 'load_more' %}";
        var placeholders = [];
        var placeholderCount = 0;
        var has_next = true;
        var isLoading = false; // Flag to track loading state

        const placeholderElements = document.getElementsByClassName('placeholder-post');
        placeholderCount = placeholderElements.length;

        for (let i = 0; i < placeholderCount; i++) {
            const placeholderClone = placeholderElements[i].cloneNode(true);
            placeholders.push(placeholderClone);
        }

        function showPlaceholders() {
            const postList = document.getElementById('post-list');

            // Add placeholders to the post list
            const placeholderElement = placeholders[0].cloneNode(true);
            postList.appendChild(placeholderElement);
        }


        function hidePlaceholders() {
            const placeholders = document.getElementsByClassName('placeholder-post');

            // Remove the placeholders from the post list
            while (placeholders.length > 0) {
                placeholders[0].parentNode.removeChild(placeholders[0]);
            }
        }

        function loadMorePosts() {
            if (isLoading) {
                return; // Return if a request is already in progress
            }

            isLoading = true; // Set loading state to true

            showPlaceholders();

            $.ajax({
                url: loadMoreUrl,
                data: {page: currentPage},
                dataType: 'json',
                success: function (response) {
                    var renderedPosts = response.rendered_posts;
                    hidePlaceholders();
                    $('#post-list').append(renderedPosts);
                    currentPage++;
                    if (!response.has_next_page) {
                        $('#load-more-button').hide();
                        has_next = false;
                    } else {
                        has_next = true;
                    }
                    isLoading = false; // Set loading state to false after request completes
                },
                error: function () {
                    hidePlaceholders();
                    isLoading = false; // Set loading state to false after request completes
                }
            });
        }

        function handleScroll() {
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollBottom = scrollTop + windowHeight;

            if (scrollBottom >= documentHeight && has_next) {
                loadMorePosts();
            }
        }

        function handleScroll(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting && has_next && !isLoading) {
                    loadMorePosts();
                }
            });
        }

        const sentinel = document.getElementById('sentinel');
        const observer = new IntersectionObserver(handleScroll, {
            root: null,
            rootMargin: '0px',
            threshold: 0.1, // Adjust this threshold as needed
        });
        observer.observe(sentinel);

        loadMorePosts();

    </script>

    <script>
    function renderTags(tags) {
        const tagList = document.getElementById('tag-list');
        tagList.innerHTML = ''; // Clear existing tags

        tags.forEach(tag => {
            const tagLink = document.createElement('a');
            tagLink.href = getTagURL(tag.slug);
            tagLink.textContent = tag.name;
            tagLink.classList.add('tag-link');

            const listItem = document.createElement('li');
            listItem.appendChild(tagLink);

            tagList.appendChild(listItem);
        });
    }

    // Function to generate the tag URL
    function getTagURL(slug) {
        return "/tag/" + slug;
    }

    // Function to check if the screen size is desktop
    function isDesktopScreen() {
        return window.innerWidth >= 992;
    }

    // Check if the screen size is desktop
    if (isDesktopScreen()) {
        // AJAX request to fetch the tags
        $.ajax({
            url: "{% url 'load_tags' %}",
            dataType: 'json',
            success: function (response) {
                const tags = response.tags;
                renderTags(tags);
            },
            error: function () {
                console.log("Failed to load tags.");
            }
        });
    } else {
        // Hide the tag container for smaller screens
        const tagContainer = document.getElementById('tag-container');
        tagContainer.style.display = 'none';
    }

    // Event listener to recheck screen size on window resize
    window.addEventListener('resize', function () {
        if (isDesktopScreen()) {
            const tagContainer = document.getElementById('tag-container');
            tagContainer.style.display = ''; // Show the tag container
            // Execute the AJAX request to fetch and render the tags
            $.ajax({
                url: "{% url 'load_tags' %}",
                dataType: 'json',
                success: function (response) {
                    const tags = response.tags;
                    renderTags(tags);
                },
                error: function () {
                    console.log("Failed to load tags.");
                }
            });
        } else {
            const tagContainer = document.getElementById('tag-container');
            tagContainer.style.display = 'none'; // Hide the tag container
        }
    });
</script>


{% endblock %}
